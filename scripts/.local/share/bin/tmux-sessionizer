#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
	selected=$1
else
	selected=$(find ~/Personal ~/Personal/CodeezNutz/*/ ~/Personal/CodeezNutz/java/Minecraft/ $XDG_CONFIG_HOME/ -mindepth 1 -maxdepth 1 -type d,l | fzf --color="bw" --no-scrollbar)
fi

if [[ -z $selected ]]; then
	exit 0
fi

selected_name=$(basename "$selected" | tr . _)
tmux_running=$(pgrep tmux)

attach() {
	if [[ -z $TMUX ]]; then
		tmux attach -t $selected_name
	else
		tmux switch-client -t $selected_name
	fi
}

create() {
	tmux new-session -s $selected_name -c $selected -d
	tmux neww -t $selected_name:9 -c $selected
	tmux selectw -t $selected_name:1
	sleep 0.150
  tmux send -t $selected_name:1 "nvim"
  tmux send -t $selected_name:2 "fastfetch"
	attach
}

if tmux has-session -t $selected_name; then
	attach
else
	create
fi
